function flippyFramey(e){function n(){var n=window.setInterval(function(){var i=u.scheme(u.index);console.log(i),u.images[u.index]=r(i),u.index++,u.index>=e.frames&&(window.clearInterval(n),g.invoke.fetchCompletion())},50)}function i(e){l.drawImage(e.image,0,0,e.width,e.height,0,0,g.canvasElement.width,g.canvasElement.height),g.invoke.draw()}function a(e){if(g.pendingUpgrade&&window.clearTimeout(g.pendingUpgrade),!e in u.images){var n=u.scheme(e),a=g.upgradeTries;u.images[e]=r(n),g.pendingUpgrade=window.setInterval(function(){d(n)?(i({image:u.images[e],width:u.width,height:u.height}),window.clearInterval(g.pendingUpgrade)):(a--,a||window.clearInterval(g.pendingUpgrade))},g.upgradeDelay)}else i({image:u.images[e],width:u.width,height:u.height});g.canUpgrade&&(g.pendingUpgrade&&window.clearTimeout(g.pendingUpgrade),g.pendingUpgrade=window.setTimeout(function(){var n=h.scheme(e);if(d(n))t(e);else{h.images[e]=r(n);var i=g.upgradeTries;window.clearTimeout(g.pendingUpgrade),g.pendingUpgrade=window.setInterval(function(){return d(n)?(t(e),g.invoke.upgradeSuccess(),void window.clearInterval(g.pendingUpgrade)):(i--,i?void 0:(window.clearInterval(g.pendingUpgrade),void g.invoke.upgradeFailure()))},g.upgradeDelay)}},g.upgradeDelay))}function t(e){g.canUpgrade&&i({image:h.images[e],width:h.width,height:h.height})}function r(e){var n=new Image;return n.src=e,n}function d(e){return r(e).complete}function o(e){e.forEach(function(e){e(g)})}function c(e){var n={};return"number"==typeof e.width&&e.width>0||(n.width="width should be a positive integer"),"number"==typeof e.height&&e.height>0||(n.height="height should be a positive integer"),("function"!=typeof e.scheme||"string"!=typeof e.scheme(1))&&(n.scheme="scheme should be a function which takes an integer and returns a string"),"number"!=typeof e.index&&(n.index="index should be an integer"),n}e=e||{};var g={on:{},stacks:{},invoke:{}};["upgradeSuccess","upgradeFailure","fetchCompletion","draw"].forEach(function(e){g.stacks[e]=[],g.on[e]=function(n){"function"==typeof n&&g.stacks[e].push(n)},g.invoke[e]=function(){o(g.stacks[e])}}),g.canvasId=e.canvas=e.canvas||"canvas";var s=g.canvasElement=document.getElementById(e.canvas),l=g.ctx=s.getContext("2d");if(!e.thumbs)return console.error("flippyFramey expects an object which specifies details regarding your thumbnail image set. See https://github.com/WilliamsNY/flippy-framey for more details"),void console.log("There are no sensible defaults we can assume.        \nTerminating flippyFramey execution NOW.");var u=g.thumbs=e.thumbs;if(u.images={},u.validated=c(u),Object.keys(u.validated).length&&console.error(u.validated),e.full){g.canUpgrade=!0;var h=g.full=e.full;h.images={},h.validated=c(h),Object.keys(h.validated).length&&console.error(h.validated),g.upgradeDelay=e.upgradeDelay||50,g.upgradeTries=e.upgradeTries||10}else g.canUpgrade=!1;return"function"==typeof e.callback&&e.callback(g),g.fetchThumbs=e.fetchThumbs||n,g.drawThumb=a,g}